<div class="pos-container">
  <!-- LEFT SIDE: Products (70%) -->
  <div class="products-section">
    <!-- Search Bar -->
    <div class="search-bar">
      <mat-icon>search</mat-icon>
      <input
        matInput
        type="text"
        [placeholder]="'pos.search' | translate"
        [value]="searchTerm()"
        (input)="searchTerm.set($any($event.target).value)"
        class="search-input"
      />
    </div>

    <!-- Categories Tabs -->
    <mat-tab-group class="categories">
      <mat-tab label="Frutas">
        <ng-template mat-tab-label>
          <mat-icon>üçé</mat-icon>
          <span>Frutas</span>
        </ng-template>
        <div class="products-grid">
          @for (product of getProductsByCategory('frutas'); track product.id) {
            <app-product-button
              [product]="product"
              (click)="selectProduct(product)"
            />
          }
        </div>
      </mat-tab>

      <mat-tab label="Verduras">
        <ng-template mat-tab-label>
          <mat-icon>ü•¨</mat-icon>
          <span>Verduras</span>
        </ng-template>
        <div class="products-grid">
          @for (product of getProductsByCategory('verduras'); track product.id) {
            <app-product-button
              [product]="product"
              (click)="selectProduct(product)"
            />
          }
        </div>
      </mat-tab>

      <mat-tab label="Ofertas">
        <ng-template mat-tab-label>
          <mat-icon>‚≠ê</mat-icon>
          <span>Ofertas</span>
        </ng-template>
        <div class="products-grid">
          @for (product of getProductsByCategory('ofertas'); track product.id) {
            <app-product-button
              [product]="product"
              (click)="selectProduct(product)"
            />
          }
        </div>
      </mat-tab>

      <mat-tab label="Varios">
        <ng-template mat-tab-label>
          <mat-icon>üì¶</mat-icon>
          <span>Varios</span>
        </ng-template>
        <div class="products-grid">
          @for (product of getProductsByCategory('varios'); track product.id) {
            <app-product-button
              [product]="product"
              (click)="selectProduct(product)"
            />
          }
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>

  <!-- RIGHT SIDE: Cart & Checkout (30%) -->
  <div class="cart-section">
    <h2>{{ 'pos.cart' | translate }}</h2>

    <!-- Cart Items List -->
    <div class="cart-items">
      @if (cartService.items().length === 0) {
        <div class="empty-cart">{{ 'pos.emptyCart' | translate }}</div>
      } @else {
        @for (item of cartService.items(); track item.product.id) {
          <div class="cart-item" (click)="selectCartItem(item)">
            <div class="item-name">{{ item.product.name }}</div>
            <div class="item-qty">
              {{ item.weight ? item.weight + ' kg' : item.quantity + 'x' }}
            </div>
            <div class="item-price">$ {{ item.subtotal }}</div>
            <button
              mat-icon-button
              (click)="removeFromCart(item); $event.stopPropagation()"
              class="delete-btn"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        }
      }
    </div>

    <!-- Item Editor -->
    @if (selectedCartItem()) {
      <app-cart-item-editor
        [item]="selectedCartItem()!"
        (quantityChange)="onQuantityChange($event)"
        (priceChange)="onPriceChange($event)"
        (close)="selectedCartItem.set(null)"
      />
    }

    <mat-divider></mat-divider>

    <!-- Totals -->
    <div class="totals">
      <div class="total-row">
        <span>{{ 'pos.subtotal' | translate }}:</span>
        <span>$ {{ cartService.subtotal() }}</span>
      </div>
      <div class="total-row">
        <span>{{ 'pos.discount' | translate }}:</span>
        <input
          matInput
          type="number"
          [value]="cartService.discount()"
          (change)="setDiscount($event)"
          placeholder="0"
        />
      </div>
      <div class="total-row total">
        <span>Total:</span>
        <span>$ {{ cartService.total() }}</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button mat-raised-button color="primary" (click)="goToPayment()">
        <mat-icon>payment</mat-icon>
        {{ 'pos.checkout' | translate }}
      </button>
      <button mat-raised-button>
        <mat-icon>schedule</mat-icon>
        En espera
      </button>
      <button 
        mat-stroked-button 
        color="warn" 
        (click)="cancelSale()"
        [disabled]="cartService.items().length === 0">
        <mat-icon>close</mat-icon>
        {{ 'pos.clear' | translate }}
      </button>
    </div>
  </div>
</div>
